# HTTP Hook Server Port
hook_server:
  port: 8080

# ========== Security Configuration (Whitelist) ==========
# clibot is essentially a Remote Code Execution (RCE) tool, so whitelist MUST be enabled.
security:
  # Whitelist enabled (default: true)
  whitelist_enabled: true

  # Allowed users (Platform -> User ID)
  allowed_users:
    telegram:
      - 123456789      # Telegram user_id example
      - 987654321
    discord:
      - "123456789012345678"  # Discord user_id example
    feishu:
      - "ou_xxx"        # Feishu open_id example (user_id)
    dingtalk:
      - "123456789"     # DingTalk staff_id example

  # Admin list (Can execute dangerous commands)
  admins:
    telegram:
      - 123456789

# ========== Watchdog Configuration ==========
watchdog:
  enabled: true
  # Polling intervals (staged to avoid frequent queries)
  check_intervals:
    - 1s    # 1st sec: Check immediate interaction
    - 2s    # 3rd sec: Check fast interaction
    - 5s    # 8th sec: Check slow interaction
  timeout: 5m  # Timeout duration

# ========== Session Configuration ==========
session:
  # Keep the last N user inputs for response extraction (Default: 10)
  # Used to extract the correct response part from tmux output,
  # especially for short inputs (menu selections like "1", "2", "y", "n") not shown in tmux.
  input_history_size: 10  # Range: 1-100

  # Maximum number of dynamically created sessions allowed (Default: 50)
  # Sessions created via IM commands (new/delete) count against this limit
  # Configured sessions in this file are not limited
  max_dynamic_sessions: 50

# tmux session management
sessions:
  # Auto-discover existing tmux sessions, or manually configure
  - name: "project-a"
    cli_type: "claude"      # claude/gemini/opencode
    work_dir: "/home/user/project-a"
    auto_start: true        # Auto-create if not exists
    # start_cmd: "claude"   # Optional: Custom command to start CLI (default: same as cli_type)

  - name: "backend-test"
    cli_type: "gemini"
    work_dir: "/home/user/tests"
    auto_start: false
    # start_cmd: "gemini"  # Example: Use alternative command

# Default session (Used when Bot doesn't specify one)
default_session: "project-a"

# Bot Configuration
bots:
  feishu:
    enabled: true
    app_id: "${FEISHU_APP_ID}"        # Read from environment variable
    app_secret: "${FEISHU_APP_SECRET}"
    # encrypt_key: "${FEISHU_ENCRYPT_KEY}"         # Optional: Event encryption key
    # verification_token: "${FEISHU_VERIFY_TOKEN}"  # Optional: Verification token

  discord:
    enabled: true
    token: "${DISCORD_TOKEN}"
    channel_id: "123456789"

  telegram:
    enabled: false
    token: "${TELEGRAM_TOKEN}"  # Telegram Bot Token from BotFather

  dingtalk:
    enabled: false
    app_id: "${DINGTALK_APP_ID}"          # DingTalk Client ID
    app_secret: "${DINGTALK_APP_SECRET}"  # DingTalk Client Secret

# CLI Adapter Configuration
cli_adapters:
  claude:
    # ========== Response Mode ==========
    # hook mode (Recommended): Requires CLI hook config, real-time response
    # polling mode: No CLI config needed, detects completion by polling tmux output
    use_hook: true  # Default: true (hook mode)

    # ========== Polling Mode Config (Used only when use_hook: false) ==========
    # poll_interval: "1s"     # Polling interval (Default: 1s)
    # stable_count: 3         # Number of stable outputs required to consider complete (Default: 3)
    # poll_timeout: "1h"      # Hard timeout (Default: 1h, completion usually determined by stable_count)

  gemini:
    use_hook: true
    # Polling Mode Config (If needed)
    # poll_interval: "2s"
    # stable_count: 4
    # poll_timeout: "1h"

  opencode:
    use_hook: true
    # Polling Mode Config (If needed)
    # poll_interval: "1s"
    # stable_count: 3
    # poll_timeout: "1h"

# Logging Configuration
logging:
  level: "info"               # debug/info/warn/error
  file: "/data/logs/clibot/clibot.log"
  max_size: 100               # MB
  max_backups: 5              # Keep 5 backups
  max_age: 30                 # Keep 30 days
  compress: true              # Compress old logs
  enable_stdout: true         # Output to console as well