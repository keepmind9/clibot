# HTTP Hook 服务端口
hook_server:
  port: 8080

# ========== 安全配置（白名单机制） ==========
# clibot 本质上是远程代码执行工具，必须启用用户白名单
security:
  # 白名单开关（默认启用）
  whitelist_enabled: true

  # 允许的用户列表（平台 -> 用户ID）
  allowed_users:
    telegram:
      - 123456789      # Telegram user_id 示例
      - 987654321
    discord:
      - "123456789012345678"  # Discord user_id 示例
    feishu:
      - "ou_xxx"        # 飞书 open_id 示例（user_id）
    dingtalk:
      - "123456789"     # 钉钉 staff_id 示例

  # 管理员列表（可以执行危险命令）
  admins:
    telegram:
      - 123456789

# ========== Watchdog 配置 ==========
watchdog:
  enabled: true
  # 分阶段轮询间隔（避免频繁查询）
  check_intervals:
    - 1s    # 第1秒：检测立即交互
    - 2s    # 第3秒：检测快速交互
    - 5s    # 第8秒：检测慢速交互
  timeout: 5m  # 超时时间

# tmux session 管理
sessions:
  # 自动发现已有 tmux session，或手动配置
  - name: "project-a"
    cli_type: "claude"      # claude/gemini/opencode
    work_dir: "/home/user/project-a"
    auto_start: true        # 如果不存在是否自动创建

  - name: "backend-test"
    cli_type: "gemini"
    work_dir: "/home/user/tests"
    auto_start: false

# 默认 session（Bot 未指定时使用）
default_session: "project-a"

# Bot 配置
bots:
  feishu:
    enabled: true
    app_id: "${FEISHU_APP_ID}"        # 从环境变量读取
    app_secret: "${FEISHU_APP_SECRET}"
    # encrypt_key: "${FEISHU_ENCRYPT_KEY}"         # 可选：事件加密密钥
    # verification_token: "${FEISHU_VERIFY_TOKEN}"  # 可选：验证令牌

  discord:
    enabled: true
    token: "${DISCORD_TOKEN}"
    channel_id: "123456789"

  telegram:
    enabled: false
    token: "${TELEGRAM_TOKEN}"  # Telegram Bot Token from BotFather

  dingtalk:
    enabled: false
    app_id: "${DINGTALK_APP_ID}"          # 钉钉 Client ID
    app_secret: "${DINGTALK_APP_SECRET}"  # 钉钉 Client Secret

# CLI 适配器配置
cli_adapters:
  claude:
    # ========== 响应模式选择 ==========
    # hook 模式（推荐）：需要 CLI 配置 hook 命令，实时响应
    # polling 模式：无需 CLI 配置，通过轮询 tmux 输出来检测完成
    use_hook: true  # 默认: true（hook 模式）

    # ========== Polling 模式配置（仅当 use_hook: false 时使用）==========
    # poll_interval: "1s"     # 轮询间隔（默认: 1s）
    # stable_count: 3         # 需要连续几次稳定输出才算完成（默认: 3）
    # poll_timeout: "120s"    # 最大等待时间（默认: 120s）

    # ========== 连接配置 ==========
    timeout: "2s"             # 连接超时（用于某些 CLI 连接检查）
    # poll_timeout: "60s"     # 轮询模式超时（独立于 timeout）

  gemini:
    use_hook: true
    timeout: "2s"
    # Polling 模式配置（如需要）
    # poll_interval: "2s"
    # stable_count: 4
    # poll_timeout: "120s"

  opencode:
    use_hook: true
    timeout: "2s"
    # Polling 模式配置（如需要）
    # poll_interval: "1s"
    # stable_count: 3
    # poll_timeout: "120s"

# 日志配置
logging:
  level: "info"               # debug/info/warn/error
  file: "/data/logs/clibot/clibot.log"
  max_size: 100               # MB
  max_backups: 5              # 保留5个备份文件
  max_age: 30                 # 保留30天
  compress: true              # 压缩旧日志
  enable_stdout: true         # 同时输出到控制台
